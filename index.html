<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Label Print 100x75</title>

<style>
@page { size: 100mm 75mm; margin: 0; }

body {
  font-family: Tahoma, Arial, sans-serif;
  margin: 8px;
}

.controls {
  margin-bottom: 12px;
}

textarea {
  width: 100%;
  height: 220px;
  font-size: 14px;
}

button {
  padding: 8px 14px;
  font-size: 15px;
  margin-top: 6px;
  cursor: pointer;
}

.label {
  width: 100mm;
  height: 75mm;
  padding: 6mm;
  box-sizing: border-box;
  border: 1px dashed #999;
  page-break-after: always;
}

.title {
  font-weight: bold;
  font-size: 13pt;
  margin-bottom: 4px;
}

.body {
  font-size: 11pt;
  line-height: 1.25;
  white-space: pre-wrap;
}

.sku {
  font-weight: bold;
  font-size: 12pt;
  margin-bottom: 3px;
}

@media print {
  .controls { display: none; }
  .label { border: none; }
}
</style>
</head>

<body>

<div class="controls">
  <h3>Paste → Print (100×75 mm)</h3>
  <p>ใช้ <b>"</b> ครอบ 1 ลาเบล / วางยาวได้เลย</p>

  <textarea id="input" placeholder='วางข้อมูล เช่น

"คุณ เฉลิมขวัญ
13/4
หมู่13
ต.คลองห้า
อ.คลองหลวง
จ.ปทุมธานี
12120
0847596746

B2"

"เก็บเงิน 379 บาท แปรง=2
ผู้รับ
คุณภชสร ธนบุญเศรษฐ์
2/342 ซอยนิมิตใหม่ 1 แยก 8 ถนนนิมิตใหม่
แขวงมีนบุรี
เขตมีนบุรี
กทม.10510
โทร0935933654"
'></textarea><br>

  <button onclick="build()">สร้างลาเบล</button>
  <button onclick="window.print()">พิมพ์</button>
</div>

<div id="out"></div>

<script>
function build(){
  const raw = document.getElementById('input').value;
  const out = document.getElementById('out');
  out.innerHTML = '';

  if(!raw) return;

  // === แยกลาเบลด้วย " ===
  const blocks = raw.split('"').map(b => b.trim()).filter(Boolean);

  blocks.forEach(block => {
    const label = parseBlock(block);
    if(!label) return;

    const el = document.createElement('div');
    el.className = 'label';

    let html = '';
    if(label.sku && label.isCOD){
      html += `<div class="sku">รหัสสินค้า: ${label.sku}</div>`;
    }

    html += `<div class="title">${label.title}</div>`;
    html += `<div class="body">${label.body}</div>`;

    if(label.sku && !label.isCOD){
      html += `<div class="sku">รหัสสินค้า: ${label.sku}</div>`;
    }

    el.innerHTML = html;
    out.appendChild(el);
  });
}

function parseBlock(text){
  let rawLines = text.split('\n').map(l=>l.trim()).filter(Boolean);

  // COD ?
  const isCOD = rawLines.some(l => l.includes('เก็บเงิน') || l.startsWith('COD'));

  // SKU (B2 ฯลฯ)
  let sku = '';
  const last = rawLines[rawLines.length-1];
  if(/^[A-Z]\d{1,2}$/i.test(last)){
    sku = last.toUpperCase();
    rawLines.pop();
  }

  // remove ผู้รับ
  rawLines = rawLines.filter(l => l !== 'ผู้รับ');

  let name = '';
  let phone = '';
  let addrLines = [];

  rawLines.forEach(l=>{
    // phone
    const m = l.match(/([0-9]{9,10})/);
    if(m && !phone){
      phone = m[1];
      return;
    }

    // name
    if(!name && l.startsWith('คุณ')){
      name = l.replace(/^คุณ\s*/,'').trim();
      return;
    }

    // note / COD line
    if(l.includes('เก็บเงิน') || l.startsWith('COD')){
      addrLines.unshift(l); // ดันขึ้นบนของที่อยู่
      return;
    }

    // address
    addrLines.push(l);
  });

  // fallback ชื่อ
  if(!name && rawLines.length){
    name = rawLines[0];
    addrLines = addrLines.slice(1);
  }

  // ===== title =====
  const title = isCOD ? 'เก็บเงินปลายทาง' : `ชื่อ: ${name}`;

  // ===== body (ระบบจัดเว้นบรรทัดให้เอง) =====
  let bodyLines = [];

  bodyLines.push(`ชื่อ: ${name}`);
  if(phone) bodyLines.push(`โทร: ${phone}`);

  if(addrLines.length){
    bodyLines.push(`ที่อยู่:`);
    addrLines.forEach(l => bodyLines.push(l));
  }

  return {
    title,
    body: bodyLines.join('\n'),
    sku,
    isCOD
  };
}

</script>

</body>
</html>
