<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Sheets → Paste → Label Print (100x75)</title>

<style>
@page {
  size: 100mm 75mm;
  margin: 0;
}

body {
  font-family: Tahoma, Arial, sans-serif;
  margin: 8px;
}

.controls {
  margin-bottom: 12px;
}

textarea {
  width: 100%;
  height: 200px;
  font-size: 14px;
}

button {
  padding: 8px 14px;
  font-size: 15px;
  margin-top: 6px;
  cursor: pointer;
}

.label {
  width: 100mm;
  height: 75mm;
  padding: 6mm;
  box-sizing: border-box;
  border: 1px dashed #999;
  page-break-after: always;
}

.label h1 {
  font-size: 14pt;
  margin: 0 0 4px 0;
}

.label pre {
  font-size: 11.5pt;
  line-height: 1.25;
  white-space: pre-wrap;
  margin: 0;
}

@media print {
  .controls {
    display: none;
  }
  .label {
    border: none;
  }
}
</style>
</head>

<body>

<div class="controls">
  <h3>Sheets → Paste → Print (100 × 75 mm)</h3>
  <p>วางข้อมูลจาก Google Sheets ได้เลย (เว้น 1 บรรทัดว่าง = 1 ลาเบล)</p>

  <textarea id="input" placeholder="วางข้อมูลตรงนี้..."></textarea><br>
  <button onclick="buildLabels()">สร้างลาเบล</button>
  <button onclick="window.print()">พิมพ์</button>
</div>

<div id="output"></div>

<script>
function buildLabels() {
  const raw = document.getElementById('input').value.replace(/\r/g,'').trim();
  const out = document.getElementById('output');
  out.innerHTML = '';

  if (!raw) return;

  // แยกเป็นก้อนด้วยบรรทัดว่าง
  const blocks = raw.split(/\n\s*\n+/);

  blocks.forEach(block => {
    const lines = block.split('\n').map(l => l.trim()).filter(Boolean);
    if (!lines.length) return;

    // หาเบอร์โทร
    let phone = '';
    for (const l of lines) {
      const m = l.match(/โทร[:\s]*([0-9\-]{9,})/i) || l.match(/^([0-9]{9,10})$/);
      if (m) phone = m[1];
    }

    // หาหัว (COD ถ้ามี ไม่งั้นใช้บรรทัดแรก)
    let title = lines.find(l => l.startsWith('COD')) || lines[0];

    // เนื้อหา
    let body = lines.filter(l => l !== title);

    if (phone && !block.includes('โทร')) {
      body.push('โทร: ' + phone);
    }

    const label = document.createElement('div');
    label.className = 'label';
    label.innerHTML = `
      <h1>${escapeHtml(title)}</h1>
      <pre>${escapeHtml(body.join('\n'))}</pre>
    `;
    out.appendChild(label);
  });
}

function escapeHtml(text) {
  return text.replace(/[&<>"']/g, m => ({
    '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'
  })[m]);
}
</script>

</body>
</html>
